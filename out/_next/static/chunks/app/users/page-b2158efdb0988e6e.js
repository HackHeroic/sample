(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{1674:function(e,s,a){Promise.resolve().then(a.bind(a,1777))},1777:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return O}});var r=a(7437),l=a(2265),t=a(4033),i=a(9155),n=a(3023),d=a(6110),c=a(2609),o=a(1908),m=a(9639),u=a(3523),x=a(9224),h=a(2442),f=a(9311);let p=m.fC;m.ZA;let j=m.B4,v=l.forwardRef((e,s)=>{let{className:a,children:l,...t}=e;return(0,r.jsxs)(m.xz,{ref:s,className:(0,f.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...t,children:[l,(0,r.jsx)(m.JO,{asChild:!0,children:(0,r.jsx)(u.Z,{className:"h-4 w-4 opacity-50"})})]})});v.displayName=m.xz.displayName;let N=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)(m.u_,{ref:s,className:(0,f.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})})});N.displayName=m.u_.displayName;let g=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)(m.$G,{ref:s,className:(0,f.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,r.jsx)(u.Z,{className:"h-4 w-4"})})});g.displayName=m.$G.displayName;let b=l.forwardRef((e,s)=>{let{className:a,children:l,position:t="popper",...i}=e;return(0,r.jsx)(m.h_,{children:(0,r.jsxs)(m.VY,{ref:s,className:(0,f.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,...i,children:[(0,r.jsx)(N,{}),(0,r.jsx)(m.l_,{className:(0,f.cn)("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,r.jsx)(g,{})]})})});b.displayName=m.VY.displayName;let y=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)(m.__,{ref:s,className:(0,f.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})});y.displayName=m.__.displayName;let w=l.forwardRef((e,s)=>{let{className:a,children:l,...t}=e;return(0,r.jsxs)(m.ck,{ref:s,className:(0,f.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(m.wU,{children:(0,r.jsx)(h.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(m.eT,{children:l})]})});w.displayName=m.ck.displayName;let C=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)(m.Z0,{ref:s,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",a),...l})});C.displayName=m.Z0.displayName;var _=a(2553),k=a(7749),S=a(220),R=a(2621),E=a(3518),z=a(164),A=a(1280),Z=a(5668),U=a(6672);function O(){var e;let{user:s,isLoading:a}=(0,S.useAuth)(),{toast:m}=(0,R.pm)(),u=(0,t.useRouter)(),[x,h]=(0,l.useState)(!1),[f,N]=(0,l.useState)([]),[g,y]=(0,l.useState)(!0),[C,O]=(0,l.useState)(!1),[P,V]=(0,l.useState)(!1),[q,B]=(0,l.useState)(!1),[I,$]=(0,l.useState)("add"),[D,X]=(0,l.useState)(""),[Y,K]=(0,l.useState)(""),[M,G]=(0,l.useState)(""),[F,J]=(0,l.useState)(""),[L,T]=(0,l.useState)([]),[H,Q]=(0,l.useState)(null),[W,ee]=(0,l.useState)(null),[es,ea]=(0,l.useState)(""),[er,el]=(0,l.useState)([]),[et,ei]=(0,l.useState)([]);(0,l.useEffect)(()=>{a||s||u.push("/login")},[s,a,u]),(0,l.useEffect)(()=>{let e=async()=>{try{let e=await (0,z.uh)();N(e)}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}finally{y(!1)}},a=async()=>{try{let e=await (0,z.vd)();T(e)}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}},r=async()=>{try{let e=await (0,z.qg)();ei(e)}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}};if(s&&s.permissions){let l=s.permissions.includes("all_permissions")||s.permissions.includes("manage_users");h(l),l?(e(),a(),r()):y(!1)}},[s,m]);let en=async()=>{if(!D.trim()||!Y.trim()||"add"===I&&!M.trim()||!F){m({title:"Error",description:"All fields are required",variant:"destructive"});return}try{let e={email:D,name:Y,role:F,..."add"===I||M?{password:M}:{}};if("add"===I){await (0,z.r4)(e);let s=await (0,z.uh)();N(s),m({title:"Success",description:"User added successfully"})}else if(null==H?void 0:H.id){await (0,z.Nq)(H.id,e);let s=await (0,z.uh)();N(s),m({title:"Success",description:"User updated successfully"})}eu()}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}},ed=async e=>{if(confirm("Are you sure you want to delete this user?"))try{await (0,z.h8)(e),N(f.filter(s=>s.id!==e)),m({title:"Success",description:"User deleted successfully"})}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}},ec=async()=>{if(""===es.trim()||0===er.length){m({title:"Error",description:"Role name and at least one permission are required",variant:"destructive"});return}try{let e={name:es,permissions:er.includes("all_permissions")?["all_permissions"]:er},s=await (0,z.fA)(e);T([...L,s]),m({title:"Success",description:"Role created successfully"}),B(!1),ea(""),el([])}catch(e){m({title:"Error",description:e.message,variant:"destructive"})}},eo=e=>{var s;$("edit"),Q(e),X(e.email),K(e.name||e.fullName||""),G(""),J(e.role||(null===(s=e.roles)||void 0===s?void 0:s[0])||""),O(!0)},em=e=>{ee(e),V(!0)},eu=()=>{O(!1),X(""),K(""),G(""),J(""),Q(null),$("add")},ex=(e,s)=>{s?el([...er,e]):el(er.filter(s=>s!==e))},eh=(e,s)=>{if(s){let s=[...er,...e],a=Array.from(new Set(s));el(a)}else el(er.filter(s=>!e.includes(s)))},ef=e=>{e?el(et):el([])},ep=e=>e.every(e=>er.includes(e));if(a||g)return(0,r.jsx)(E.Z,{children:(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Users"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage system users"})]}),(0,r.jsx)(d.Zb,{children:(0,r.jsx)(d.aY,{className:"pt-6",children:(0,r.jsx)(A.g,{})})})]})});if(!x)return(0,r.jsx)(E.Z,{children:(0,r.jsx)(Z.Z,{})});let ej=(()=>{let e={};return et.filter(e=>"all_permissions"!==e).forEach(s=>{let a=s.split("_"),r=a.slice(1).join("_");r&&(e[r]||(e[r]=[]),e[r].push(s))}),Object.keys(e).forEach(s=>{e[s].sort((e,s)=>{let a=["view","create","edit","delete","manage"],r=e.split("_")[0],l=s.split("_")[0],t=-1!==a.indexOf(r)?a.indexOf(r):999,i=-1!==a.indexOf(l)?a.indexOf(l):999;return t-i||e.localeCompare(s)})}),e})();return(0,r.jsx)(E.Z,{children:(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Users"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage system users"})]}),(0,r.jsx)(n.z,{onClick:()=>{$("add"),X(""),K(""),G(""),J(""),Q(null),O(!0)},className:"bg-[#6B46C1] hover:bg-[#5a3aa3]",children:"Add User"})]}),(0,r.jsxs)(d.Zb,{children:[(0,r.jsx)(d.Ol,{children:(0,r.jsx)(d.ll,{children:"All Users"})}),(0,r.jsx)(d.aY,{children:0===f.length?(0,r.jsx)("p",{children:"No users found."}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(_.iA,{children:[(0,r.jsx)(_.xD,{children:(0,r.jsxs)(_.SC,{children:[(0,r.jsx)(_.ss,{className:"hidden md:table-cell",children:"ID"}),(0,r.jsx)(_.ss,{children:"Email"}),(0,r.jsx)(_.ss,{className:"hidden md:table-cell",children:"Name"}),(0,r.jsx)(_.ss,{children:"Role"}),(0,r.jsx)(_.ss,{className:"hidden lg:table-cell",children:"Permissions"}),(0,r.jsx)(_.ss,{children:"Actions"})]})}),(0,r.jsx)(_.RM,{children:f.map(e=>{var s;return(0,r.jsxs)(_.SC,{className:"cursor-pointer",onClick:()=>em(e),children:[(0,r.jsx)(_.pj,{className:"hidden md:table-cell font-medium",children:e.id}),(0,r.jsx)(_.pj,{className:"max-w-[120px] truncate",children:e.email}),(0,r.jsx)(_.pj,{className:"hidden md:table-cell",children:e.name||e.fullName||"-"}),(0,r.jsx)(_.pj,{children:(0,r.jsx)(i.C,{variant:"outline",className:"bg-[#6B46C1] text-white",children:e.role||(null===(s=e.roles)||void 0===s?void 0:s[0])||"No Role"})}),(0,r.jsx)(_.pj,{className:"hidden lg:table-cell",children:(0,r.jsxs)(i.C,{variant:"secondary",children:[e.permissions.length," permissions"]})}),(0,r.jsx)(_.pj,{onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>eo(e),children:"Edit"}),(0,r.jsx)(n.z,{variant:"destructive",size:"sm",onClick:()=>ed(e.id),children:"Delete"})]})})]},e.id)})})]})})})]}),(0,r.jsx)(c.Vq,{open:C,onOpenChange:e=>{O(e),e||eu()},children:(0,r.jsxs)(c.cZ,{children:[(0,r.jsx)(c.fK,{children:(0,r.jsx)(c.$N,{children:"add"===I?"Add New User":"Edit User"})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{children:"Email"}),(0,r.jsx)(o.I,{placeholder:"Email",value:D,onChange:e=>X(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{children:"Name"}),(0,r.jsx)(o.I,{placeholder:"Full Name",value:Y,onChange:e=>K(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(U._,{children:["Password"," ","edit"===I&&"(leave empty to keep current)"]}),(0,r.jsx)(o.I,{type:"password",placeholder:"Password",value:M,onChange:e=>G(e.target.value)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(U._,{children:"Role"}),(0,r.jsxs)(p,{value:F,onValueChange:J,children:[(0,r.jsx)(v,{children:(0,r.jsx)(j,{placeholder:"Select Role"})}),(0,r.jsx)(b,{children:L.map(e=>(0,r.jsx)(w,{value:e.name,children:e.name},e.name))})]})]}),(0,r.jsx)(n.z,{variant:"default",size:"sm",onClick:()=>B(!0),className:"mt-6 bg-[#6B46C1] hover:bg-[#5a3aa3]",children:"+ New Role"})]})]}),(0,r.jsx)(c.cN,{children:(0,r.jsx)(n.z,{onClick:en,className:"bg-[#6B46C1] hover:bg-[#5a3aa3]",children:"add"===I?"Save User":"Update User"})})]})}),(0,r.jsx)(c.Vq,{open:P,onOpenChange:V,children:(0,r.jsxs)(c.cZ,{className:"max-w-[90vw] sm:max-w-lg md:max-w-xl lg:max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,r.jsx)(c.fK,{children:(0,r.jsx)(c.$N,{children:"View User"})}),W&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"font-semibold",children:"ID:"}),(0,r.jsx)("p",{className:"text-sm",children:W.id||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"font-semibold",children:"Email:"}),(0,r.jsx)("p",{className:"text-sm",children:W.email||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"font-semibold",children:"Name:"}),(0,r.jsx)("p",{className:"text-sm",children:W.name||W.fullName||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"font-semibold",children:"Role:"}),(0,r.jsx)("p",{className:"text-sm",children:W.role||(null===(e=W.roles)||void 0===e?void 0:e[0])||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{className:"font-semibold",children:"Permissions:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:W.permissions.map(e=>(0,r.jsx)(i.C,{variant:"outline",className:"text-xs",children:e},e))})]})]}),(0,r.jsx)(c.cN,{children:(0,r.jsx)(n.z,{variant:"outline",onClick:()=>V(!1),children:"Close"})})]})}),(0,r.jsx)(c.Vq,{open:q,onOpenChange:B,children:(0,r.jsxs)(c.cZ,{className:"max-w-lg max-h-[80vh] overflow-y-auto",children:[(0,r.jsx)(c.fK,{children:(0,r.jsx)(c.$N,{children:"Add New Role"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U._,{children:"Role Name"}),(0,r.jsx)(o.I,{placeholder:"Role Name",value:es,onChange:e=>ea(e.target.value),className:"mb-4"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)(U._,{className:"text-sm font-medium mb-2 block",children:"Permissions"}),(0,r.jsxs)("div",{className:"max-h-64 overflow-y-auto border rounded-md p-3",children:[(0,r.jsx)("div",{className:"border-b pb-2 mb-2",children:(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,r.jsx)(k.X,{checked:et.every(e=>er.includes(e)),onCheckedChange:e=>ef(e)}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"All Permissions"})]})}),Object.entries(ej).map(e=>{let[s,a]=e;return(0,r.jsxs)("div",{className:"border-b pb-2 mb-2 last:border-b-0",children:[(0,r.jsxs)("label",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)(k.X,{checked:ep(a),onCheckedChange:e=>eh(a,e)}),(0,r.jsx)("span",{className:"text-sm font-medium capitalize",children:s})]}),(0,r.jsx)("div",{className:"ml-6 flex flex-wrap gap-2",children:a.map(e=>(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,r.jsx)(k.X,{checked:er.includes(e),onCheckedChange:s=>ex(e,s)}),(0,r.jsx)("span",{className:"text-xs",children:e.split("_")[0]})]},e))})]},s)})]})]}),(0,r.jsx)(c.cN,{children:(0,r.jsx)(n.z,{onClick:ec,className:"bg-[#6B46C1] hover:bg-[#5a3aa3]",children:"Save Role"})})]})})]})})}},9155:function(e,s,a){"use strict";a.d(s,{C:function(){return n}});var r=a(7437);a(2265);var l=a(9213),t=a(9311);let i=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...l}=e;return(0,r.jsx)("div",{className:(0,t.cn)(i({variant:a}),s),...l})}},7749:function(e,s,a){"use strict";a.d(s,{X:function(){return d}});var r=a(7437),l=a(2265),t=a(6062),i=a(2442),n=a(9311);let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)(t.fC,{ref:s,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...l,children:(0,r.jsx)(t.z$,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})})});d.displayName=t.fC.displayName}},function(e){e.O(0,[141,303,51,45,670,80,971,864,744],function(){return e(e.s=1674)}),_N_E=e.O()}]);